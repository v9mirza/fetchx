#!/usr/bin/env python3

import os
import platform
import shutil

# ================= ASCII LOGO =================

ASCII_LOGO = r"""
   ███████╗███████╗████████╗ ██████╗██╗  ██╗██╗  ██╗
   ██╔════╝██╔════╝╚══██╔══╝██╔════╝██║  ██║╚██╗██╔╝
   █████╗  █████╗     ██║   ██║     ███████║ ╚███╔╝
   ██╔══╝  ██╔══╝     ██║   ██║     ██╔══██║ ██╔██╗
   ██║     ███████╗   ██║   ╚██████╗██║  ██║██╔╝ ██╗
   ╚═╝     ╚══════╝   ╚═╝    ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝
"""

# ================= HELPERS =================

def os_name():
    try:
        with open("/etc/os-release") as f:
            for line in f:
                if line.startswith("PRETTY_NAME"):
                    return line.split("=", 1)[1].strip().strip('"')
    except:
        pass
    return platform.system()

def uptime():
    try:
        with open("/proc/uptime") as f:
            seconds = float(f.readline().split()[0])
        h = int(seconds // 3600)
        m = int((seconds % 3600) // 60)
        return f"{h}h {m}m"
    except:
        return "unknown"

def memory():
    try:
        mem = {}
        with open("/proc/meminfo") as f:
            for line in f:
                k, v = line.split(":")
                mem[k] = int(v.strip().split()[0])
        total = mem["MemTotal"] // 1024
        avail = mem["MemAvailable"] // 1024
        used = total - avail
        return f"{used}MB / {total}MB"
    except:
        return "unknown"

def cpu():
    try:
        with open("/proc/cpuinfo") as f:
            for line in f:
                if "model name" in line:
                    return line.split(":", 1)[1].strip()
    except:
        pass
    return "unknown"

def gpus():
    try:
        out = os.popen("lspci | grep -Ei 'vga|3d|display'").read().strip()
        if not out:
            return []
        return [line.split(": ", 1)[1] for line in out.splitlines()]
    except:
        return []

def packages():
    try:
        if shutil.which("pacman"):
            return os.popen("pacman -Qq | wc -l").read().strip()
        if shutil.which("dpkg"):
            return os.popen("dpkg -l | grep '^ii' | wc -l").read().strip()
        if shutil.which("rpm"):
            return os.popen("rpm -qa | wc -l").read().strip()
    except:
        pass
    return None

def desktop():
    return (
        os.environ.get("XDG_CURRENT_DESKTOP")
        or os.environ.get("DESKTOP_SESSION")
        or "tty"
    )

def terminal():
    return os.environ.get("TERM_PROGRAM") or os.environ.get("TERM") or "unknown"

def user():
    return os.environ.get("USER", "unknown")

def row(label, value, cyan, reset):
    return f"{cyan}{label:<10}{reset} {value}"

# ================= MAIN =================

def main():
    cyan = "\033[36m"
    reset = "\033[0m"

    print(f"{cyan}{ASCII_LOGO}{reset}")

    print(row("OS:", os_name(), cyan, reset))
    print(row("Kernel:", platform.release(), cyan, reset))
    print(row("Arch:", platform.machine(), cyan, reset))
    print(row("Host:", platform.node(), cyan, reset))
    print(row("Desktop:", desktop(), cyan, reset))
    print(row("CPU:", cpu(), cyan, reset))

    for i, gpu in enumerate(gpus(), 1):
        label = "GPU:" if i == 1 else f"GPU {i}:"
        print(row(label, gpu, cyan, reset))

    print(row("Memory:", memory(), cyan, reset))

    pkgs = packages()
    if pkgs:
        print(row("Packages:", pkgs, cyan, reset))

    print(row("Uptime:", uptime(), cyan, reset))
    print(row("Shell:", os.environ.get("SHELL", "unknown"), cyan, reset))
    print(row("Terminal:", terminal(), cyan, reset))
    print(row("User:", user(), cyan, reset))

if __name__ == "__main__":
    main()
